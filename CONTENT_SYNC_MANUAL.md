# 硅基能效官网：内容同步协议与操作手册 (Content Sync Protocol)

本文档定义了从 **微信公众号内容库 (Source)** 到 **官网 (Target)** 的自动化同步机制、标记字段规范及操作流程。

## 1. 核心机制 (Mechanism)

官网内容不直接编辑，而是作为下游，从微信内容库中 **"精选搬运"**。

*   **源头 (Source)**: `d:\gjnx\03_Content_Factory\01_WeChat\Published\` (所有子目录)
*   **目标 (Target)**: `d:\gjnx\05_Official_Website\src\content\articles\`
*   **执行者 (Executor)**: `npm run sync` (集成在 `/deploy-site` 工作流中)

### 3大核心原则
1.  **Frontmatter 即指令**：文章头部的元数据决定了一切（是否同步、URL 是什么、标题是什么）。
2.  **AI 质量警察**：脚本会自动拦截字数过少 (<800字) 或包含 "通知/招聘" 等关键词的水文，除非你强制放行。
3.  **流量熔断**：单次同步最多只会新增 **5篇** 文章，防止洪水式刷屏。

---

## 2. 标记字段字典 (Field Dictionary)

请在微信文章的 Markdown 头部使用以下字段进行控制。

| 字段名 (Key) | 类型 | 必填? | 说明与默认行为 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **`title`** | string | ✅ | 文章标题。 | 不要改动，脚本会自动读取。 |
| **`date`** | date | ✅ | 发布日期 `YYYY-MM-DD`。 | 也影响 URL 的时间前缀。 |
| **`tags`** | array | ❌ | 标签 `["芯片", "AI"]`。 | 会自动转为官网页面的 Keywords SEO。 |
| **`sync`** | boolean | ❌ | **同步开关**。 <br> `true`: 强制上架（无视质量检查）。<br> `false`: **强制下架**（即使已上线也会被删除）。<br> `undefined`(不填): 走 AI 智能筛选逻辑。 | **最常用的控制开关。** |
| **`website_slug`** | string | ❌ | **官网 URL 后缀**。 <br> 例: `intel-18a-analysis`。<br> **不填**: 脚本首次运行时会自动根据 `date` + `title(拼音/英文)` 生成并**回写**到此文件。 | **一旦生成，请勿轻易修改**，否则会产生死链接或重复文章。 |
| **`description`** | string | ❌ | SEO 描述。 <br> **不填**: 自动截取正文前 120 字。 | 建议手写一段吸引人的摘要。 |

## 2.5 快速复制模板 (Copy & Paste)

写新文章时，请直接复制以下头部：

```yaml
---
title: "文章标题"
date: 2025-12-25
tags: ["标签1", "标签2"]
description: "这里写一段吸引人的摘要（120字以内），如果不写会自动截取正文。"

# --- 官网控制区 (Optional) ---
# sync: true           # 强制上架（即使字数少）
# sync: false          # 强制下架/不上架
# website_slug: "custom-url-name"  # 手动指定 URL，不填则自动生成
---
```

---

## 3. 操作流程 (SOP)

### 场景 A：发布一篇新文章 (标准流程)
1.  在微信目录写完文章。
2.  **动作**：什么都不用做（或者填好 `tags` 和 `description`）。
3.  **结果**：下次部署时，AI 会检查字数。如果合格，自动生成 `website_slug`，搬运上线。

### 场景 B：拒绝某篇文章上线 (如：放假通知)
1.  打开该文章 `.md`。
2.  **动作**：在头部添加 `sync: false`。
3.  **结果**：脚本会直接跳过此文。如果官网之前已经有了，会被**自动删除**。

### 场景 C：强制上架一篇短文 (如：重磅快讯)
1.  该文章字数可能少于 800 字，会被 AI 拦截。
2.  **动作**：在头部添加 `sync: true`。
3.  **结果**：AI 看到真值，直接放行上线。

### 场景 D：自定义 URL (SEO 优化)
1.  在脚本**第一次运行前**（即还没有生成 default slug 时）。
2.  **动作**：在头部明确写上 `website_slug: my-custom-url-v1`。
3.  **结果**：脚本优先使用你指定的 URL，不进行自动生成。

### 场景 E：发布后推送 SEO
1.  确认网站已在 Vercel 部署成功。
2.  **动作**：在本地运行 `npm run push-seo`。
3.  **结果**：本地构建生成 sitemap，并主动推送给百度。

---

## 4. 常见问题 (FAQ)

**Q: 我修改了微信文章的标题，官网会自动更新吗？**
A: **会。** 内容和标题的更新是覆盖式的，只要 `website_slug` 没变，URL 就不变，但内容会更新。

**Q: 官网文章排版乱了怎么办？**
A: 脚本会自动清洗掉微信特有的 `<div ...>` 广告和扫码图。如果还有残留，请手动调整脚本 `cleanWeChatContent` 逻辑，或者在源文件里调整 Markdown 格式。

**Q: 我如果不小心改了 `website_slug` 怎么办？**
A: 脚本会以为这是一篇**新文章**，于是再生成一个新网页。旧网页会变成“孤儿”（还在官网目录里，但失去了源头控制）。你需要去 `05_Official_Website/src/content/articles/` 手动删掉旧文件。

