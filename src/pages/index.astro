---
import Layout from '../layouts/Layout.astro';
import EfficiencyCalculatorPro from '../components/EfficiencyCalculatorPro.astro';
import { getCollection } from 'astro:content';

// Fetch articles
const latestArticles = (await getCollection('articles'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);
---

<Layout title="首页">
  <main>
    <!-- Hero Section -->
    <section class="hero">
      <div class="container">
        <div class="status-indicator">
          <span class="dot"></span> SYSTEM ONLINE
        </div>
        <h1 class="title">硅基能效 <span class="text-gradient">2025</span></h1>
        <p class="subtitle">Deconstructing Silicon Efficiency // 解构每一瓦特的算力价值</p>
        
        <div class="hero-actions">
          <a href="#tools" class="btn primary">启动能效推演</a>
          <a href="#data" class="btn secondary">查看生存地图</a>
        </div>
      </div>
    </section>

    <!-- Content Engine Section (Dynamic) -->
    <section class="section" id="data">
      <div class="container">
        <div class="section-header">
          <h2><span class="mono">01.</span> 能效翻译官</h2>
          <p class="section-desc">解码最新硬核技术，不看参数看本质。</p>
        </div>

        <div class="article-grid">
          {latestArticles.map(post => (
            <a href={`/articles/${post.id}`} class="article-card">
              <div class="card-header">
                <span class="date mono">{post.data.date.toLocaleDateString()}</span>
                <span class="tag mono">[{post.data.tags?.[0] || 'LOG'}]</span>
              </div>
              <h3>{post.data.title}</h3>
              <p>{post.data.description}</p>
              <div class="card-footer mono">
                > READ_LOG
              </div>
            </a>
          ))}
        </div>
      </div>
    </section>

    <!-- Interactive Tools Section -->
    <section class="section dark-bg" id="tools">
      <div class="container center-text">
        <h2><span class="mono">02.</span> 交互式推演</h2>
        <p class="max-w-600">选择你的芯片架构与电池方案，实时预测终端设备的续航表现。</p>
        
        <div class="tool-wrapper">
          <EfficiencyCalculatorPro />
        </div>
      </div>
    </section>

  </main>
</Layout>

<style>
  main {
    padding-top: 80px;
  }

  /* Hero (Keep existing styles) */
  .hero {
    min-height: 80vh;
    display: flex;
    align-items: center;
    position: relative;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  .status-indicator { font-family: var(--font-mono); font-size: 0.8rem; color: var(--c-accent-cyan); margin-bottom: 1rem; display: flex; align-items: center; gap: 8px; }
  .dot { width: 8px; height: 8px; background: var(--c-accent-cyan); border-radius: 50%; box-shadow: 0 0 10px var(--c-accent-cyan); animation: pulse 2s infinite; }
  .title { font-size: 4rem; font-weight: 800; line-height: 1.1; margin-bottom: 1rem; letter-spacing: -2px; }
  .subtitle { font-size: 1.5rem; color: var(--c-text-secondary); margin-bottom: 3rem; font-weight: 300; }
  .hero-actions { display: flex; gap: 1rem; }
  .btn { padding: 1rem 2rem; border-radius: 4px; text-decoration: none; font-weight: 600; transition: all 0.2s; }
  .btn.primary { background: var(--c-text-primary); color: var(--c-bg-dark); }
  .btn.primary:hover { background: var(--c-accent-cyan); box-shadow: 0 0 20px rgba(0,240,255,0.4); }
  .btn.secondary { border: 1px solid rgba(255,255,255,0.2); color: var(--c-text-primary); }

  /* Sections */
  .section { padding: 6rem 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
  .section-header { margin-bottom: 3rem; }
  .section-desc { color: var(--c-text-secondary); margin-top: 0.5rem; }
  h2 { font-size: 2.5rem; margin-bottom: 0.5rem; }
  .mono { color: var(--c-accent-cyan); font-family: var(--font-mono); }

  /* Article Grid (Cyberpunk Cards) */
  .article-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }
  
  .article-card {
    display: block;
    background: #0f0f0f;
    border: 1px solid #333;
    padding: 2rem;
    text-decoration: none;
    color: inherit;
    transition: all 0.3s ease;
    border-radius: 4px;
    position: relative;
    overflow: hidden;
  }

  .article-card:hover {
    border-color: var(--c-accent-cyan);
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  }

  .article-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 4px; height: 100%;
    background: var(--c-accent-cyan);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .article-card:hover::before { opacity: 1; }

  .card-header {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: #666;
    margin-bottom: 1rem;
    border-bottom: 1px dashed #333;
    padding-bottom: 0.5rem;
  }

  .article-card h3 {
    font-size: 1.5rem;
    margin: 0 0 1rem 0;
    line-height: 1.3;
  }

  .article-card p {
    color: #888;
    font-size: 0.95rem;
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card-footer {
    margin-top: 1.5rem;
    font-size: 0.9rem;
    text-align: right;
    color: var(--c-accent-cyan);
    opacity: 0.5;
  }
  .article-card:hover .card-footer { opacity: 1; text-shadow: 0 0 5px var(--c-accent-cyan); }

  /* Tools Section */
  .center-text { text-align: center; display: flex; flex-direction: column; align-items: center; }
  .max-w-600 { max-width: 600px; margin-left: auto; margin-right: auto; color: var(--c-text-secondary); margin-bottom: 3rem; }
  .tool-wrapper { margin-top: 2rem; }

  @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
</style>
