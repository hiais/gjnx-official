---
import MainLayout from '../../layouts/MainLayout.astro';
import Card from '../../components/ui/Card.astro';
import Tag from '../../components/ui/Tag.astro';
import { getCollection } from 'astro:content';
import SectionHeader from '../../components/ui/SectionHeader.astro';

const allArticles = await getCollection('articles');
const sortedArticles = allArticles
  .filter(a => !a.data.draft)
  .sort((a, b) => (b.data.date?.getTime() || 0) - (a.data.date?.getTime() || 0));
---

<MainLayout title="深度专栏 | Column">
  <SectionHeader 
    title="深度" 
    ghostTitle="专栏" 
    subtitle="硅基能效核心叙事：专注于底层能效架构、博弈与进化真相的高级情报档案。"
  />

  <div class="container section">

    <div class="grid">
      {sortedArticles.map(article => (
        <Card href={`/articles/${article.id}`} class="article-card">
          <div class="card-meta">
            <span class="date mono">{article.data.date?.toISOString().split('T')[0]}</span>
            {article.data.tags?.slice(0, 1).map((tag: any) => (
              <Tag variant="outline">{tag}</Tag>
            ))}
          </div>
          <h3 class="card-title">{article.data.title}</h3>
          <p class="card-desc">{article.data.description}</p>
        </Card>
      ))}
    </div>
  </div>
</MainLayout>

<style>
  .section { padding: var(--space-12) 0 var(--space-20); }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: var(--space-6);
  }
  
  .card-meta { 
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    margin-bottom: var(--space-4); 
    font-size: 0.8rem; 
  }
  
  .date { color: var(--c-text-muted); }
  
  .card-title { 
    font-size: 1.2rem; 
    margin-bottom: var(--space-3);
    line-height: 1.4;
    /* Clamp to 2 lines max */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .card-desc { 
    color: var(--c-text-secondary); 
    font-size: 0.9rem; 
    line-height: 1.6;
    /* Clamp to 3 lines max */
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
