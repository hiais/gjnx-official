---
title: "ã€ç¡¬æ ¸æé—®ã€‘ä½ ä¸º 100% äº‘ CPU ä»˜è´¹ï¼Œä½†åªç”¨åˆ° 70%ï¼ŸHypervisor éšè—çš„è™šæ‹ŸåŒ–èƒ½è€—ç¨"
date: "2025-12-20T00:00:00.000Z"
tags: ["äº‘è®¡ç®—","è™šæ‹ŸåŒ–","Hypervisor","èƒ½è€—ç¨"]
category: "Deep Column"
description: "ğŸ“„ Abstract\r \r >   æ‘˜è¦ï¼š  \r > äº‘è®¡ç®—çš„æœ¬è´¨æ˜¯å°†ä¸€å°ç‰©ç†æœåŠ¡å™¨ï¼ˆHostï¼‰çš„èµ„æºåˆ‡åˆ†ç»™æ•°åä¸ªç”¨æˆ·ï¼ˆGuestï¼‰ã€‚ä½ ç§Ÿç”¨äº†ä¸€ä¸ª 4 æ ¸ vCPU çš„å®ä¾‹ï¼Œä½†å…¶æ€§èƒ½æ°¸è¿œè¾¾ä¸åˆ°ç‰©ç† 4 æ ¸çš„ç†è®ºæé™ã€‚è¿™ç§æ€§èƒ½æŸå¤±å’Œé¢å¤–çš„èƒ½è€—è¢«ç§°ä¸º   â€œè™šæ‹ŸåŒ–èƒ½è€—ç¨â€  ã€‚ç¨æ”¶çš„å¾æ”¶è€…æ˜¯ Hypervisor..."
---

### ğŸ“„ Abstract

> **æ‘˜è¦ï¼š**
> äº‘è®¡ç®—çš„æœ¬è´¨æ˜¯å°†ä¸€å°ç‰©ç†æœåŠ¡å™¨ï¼ˆHostï¼‰çš„èµ„æºåˆ‡åˆ†ç»™æ•°åä¸ªç”¨æˆ·ï¼ˆGuestï¼‰ã€‚ä½ ç§Ÿç”¨äº†ä¸€ä¸ª 4 æ ¸ vCPU çš„å®ä¾‹ï¼Œä½†å…¶æ€§èƒ½æ°¸è¿œè¾¾ä¸åˆ°ç‰©ç† 4 æ ¸çš„ç†è®ºæé™ã€‚è¿™ç§æ€§èƒ½æŸå¤±å’Œé¢å¤–çš„èƒ½è€—è¢«ç§°ä¸º **â€œè™šæ‹ŸåŒ–èƒ½è€—ç¨â€**ã€‚ç¨æ”¶çš„å¾æ”¶è€…æ˜¯ Hypervisorï¼Œå®ƒå¿…é¡»æ¶ˆè€— CPU å‘¨æœŸæ¥å®Œæˆ **æƒé™ç®¡ç†ã€æŒ‡ä»¤ç¿»è¯‘ã€ä¸­æ–­å¤„ç†** ç­‰ä»»åŠ¡ã€‚æœ¬æ–‡å°†é‡åŒ–è¿™ä¸€æŸè€—ï¼Œæ­ç¤º Hypervisor æŠ¢å ï¼ˆSteal Timeï¼‰å¦‚ä½•å¯¼è‡´ç”¨æˆ·å®é™…å¯ç”¨æ€§èƒ½ä½è‡³ 70%ï¼Œå¹¶æ¢è®¨æœªæ¥ AI æ•°æ®ä¸­å¿ƒå¦‚ä½•é€šè¿‡ **è£¸é‡‘å±ï¼ˆBare Metalï¼‰ä¸å®¹å™¨åŒ–** æ¶æ„é™ä½è¿™ç¬”éšå½¢ç¨ã€‚

---

## 1. ğŸ¤¯ å›°å¢ƒï¼šä¸ºä»€ä¹ˆäº‘ CPU æ°¸è¿œè·‘ä¸æ»¡ï¼Ÿ

å½“ä½ åœ¨ AWSã€Azure æˆ–é˜¿é‡Œäº‘ä¸Šå¯åŠ¨ä¸€ä¸ª ECS/EC2 å®ä¾‹æ—¶ï¼Œç³»ç»ŸæŠ¥å‘Šç»™ä½  100% çš„ CPU å¯ç”¨ç‡ã€‚ç„¶è€Œï¼Œæ— è®ºæ˜¯è¿›è¡Œé«˜å¹¶å‘çš„ Web æœåŠ¡è¿˜æ˜¯å¤æ‚çš„ AI è®­ç»ƒï¼Œä½ æ€»æ˜¯è§‰å¾—æ€§èƒ½æœ‰é‚£ä¹ˆä¸€ä¸â€œä¸è¶³â€ã€‚


ä½ è´­ä¹°çš„ 100% CPU èµ„æºï¼ŒåŒ…å«äº†ä¸¤ä¸ªéƒ¨åˆ†ï¼š
1.  **Workload Timeï¼š** çœŸæ­£æ‰§è¡Œä½ åº”ç”¨ç¨‹åºæŒ‡ä»¤çš„æ—¶é—´ï¼ˆä¸ºä½ åˆ›é€ ä»·å€¼ï¼‰ã€‚
2.  **Overhead Time (Hypervisor Tax)ï¼š** Hypervisor ä¸ºç»´æŠ¤è™šæ‹Ÿç¯å¢ƒè€Œæ¶ˆè€—çš„æ—¶é—´ï¼ˆä¸ºä½ æä¾›çš„æœåŠ¡ä¹°å•ï¼‰ã€‚

ä½ çš„åº”ç”¨ç¨‹åºæƒ³è¦è®¿é—®ç¡¬ç›˜ã€ç½‘å¡æˆ–å†…å­˜æ—¶ï¼Œä¸èƒ½ç›´æ¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œå¿…é¡»å…ˆ**é€€å‡ºè™šæ‹Ÿæœº**ï¼Œè¯·æ±‚ Hypervisor ä»£ä¸ºæ‰§è¡Œã€‚è¿™ä¸ªé¢‘ç¹çš„â€œè¿›å‡ºâ€è¿‡ç¨‹ï¼Œå°±æ˜¯èƒ½è€—å’Œå»¶è¿Ÿçš„æºå¤´ã€‚



---

## 2. ğŸŒ¡ï¸ æ ¸å¿ƒåŸç†ï¼šRing-0 é™·é˜±ä¸æŒ‡ä»¤ç¿»è¯‘

Hypervisor å­˜åœ¨çš„æ ¹æœ¬åŸå› åœ¨äº **ç‰¹æƒä¿æŠ¤**ã€‚CPU ç¡¬ä»¶è®¾è®¡äº†å¤šä¸ªæƒé™çº§åˆ«ï¼ˆRingsï¼‰ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸è¿è¡Œåœ¨æœ€é«˜çš„ **Ring-0**ã€‚

### 2.1 Ring-0 çš„æƒé™é™·é˜±

è™šæ‹Ÿæœºï¼ˆGuest OSï¼‰ä¹Ÿè‡ªè®¤ä¸ºè¿è¡Œåœ¨ Ring-0ï¼Œä½†å®é™…ä¸Šå®ƒè¢« Hypervisor é™çº§åˆ°äº† **Ring-1**ï¼ˆæˆ– Ring-3ï¼‰ã€‚
å½“ Guest OS è¯•å›¾æ‰§è¡Œä»»ä½•æ¶‰åŠåˆ°ç¡¬ä»¶æˆ–æƒé™çš„æŒ‡ä»¤ï¼ˆä¾‹å¦‚ `IN/OUT` æŒ‡ä»¤ï¼‰ï¼ŒCPU ç¡¬ä»¶ä¼šç«‹å³å‘ç° Guest çš„æƒé™ä¸è¶³ï¼Œè§¦å‘ä¸€ä¸ª **Trapï¼ˆé™·é˜±ï¼‰**ã€‚

$$E_{Trap} \propto N_{Privileged\_Ins} \times C_{context\_switch}$$

* **$N_{Privileged\_Ins}$:** ç‰¹æƒæŒ‡ä»¤æ‰§è¡Œæ¬¡æ•°ã€‚
* **$C_{context\_switch}$:** å‘ç”Ÿé™·é˜±æ—¶ï¼ŒCPU ä¸Šä¸‹æ–‡åˆ‡æ¢çš„èƒ½è€—å’Œæ—¶é—´æˆæœ¬ã€‚

æ¯ä¸€æ¬¡ Trapï¼ŒHypervisor éƒ½ä¼šä»‹å…¥ï¼Œæ£€æŸ¥æŒ‡ä»¤æ˜¯å¦å®‰å…¨ï¼Œç„¶å**æ¨¡æ‹Ÿ**ç¡¬ä»¶è¡Œä¸ºï¼Œæœ€åå†å°†æ§åˆ¶æƒäº¤è¿˜ç»™ Guest OSã€‚è¿™ä¸€ç³»åˆ—çš„åˆ‡æ¢å’Œæ¨¡æ‹Ÿï¼Œæ¶ˆè€—äº†å¤§é‡çš„ CPU å‘¨æœŸï¼Œé€ æˆæ€§èƒ½æŸå¤± **10% - 30%** ä¸ç­‰ã€‚

### 2.2 å†…å­˜è™šæ‹ŸåŒ–ï¼ˆShadow Page Tableï¼‰

ä¸ºäº†éš”ç¦»å„ä¸ªè™šæ‹Ÿæœºçš„å†…å­˜ï¼ŒHypervisor å¿…é¡»ç»´æŠ¤ **å½±å­é¡µè¡¨ï¼ˆShadow Page Tableï¼‰**ã€‚
æ¯æ¬¡ Guest OS æ›´æ”¹è‡ªå·±çš„é¡µè¡¨æ—¶ï¼ŒHypervisor éƒ½è¦åŒæ­¥æ›´æ–°å½±å­é¡µè¡¨ã€‚è¿™ä¸ªåŒæ­¥è¿‡ç¨‹ä¼šäº§ç”Ÿå¤§é‡çš„ **TLBï¼ˆè½¬è¯‘åå¤‡ç¼“å†²å™¨ï¼‰å¤±æ•ˆ**å’Œå†…å­˜è®¿é—®ï¼Œå¤§å¤§å¢åŠ äº†å†…å­˜å­ç³»ç»Ÿçš„åŠŸè€—ã€‚



---

## 3. âš™ï¸ æ ¸å¿ƒæ¶æ„ï¼šç¡¬ä»¶è¾…åŠ©ä¸ I/O è™šæ‹ŸåŒ–

ä¸ºäº†é™ä½è™šæ‹ŸåŒ–èƒ½è€—ç¨ï¼Œç°ä»£ CPU å¼•å…¥äº† **ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–æŠ€æœ¯**ï¼ˆå¦‚ Intel VT-x/AMD-Vï¼‰ã€‚

### 3.1 ç¡¬ä»¶è¾…åŠ©çš„åŠ é€Ÿï¼ˆVT-x/AMD-Vï¼‰

ç¡¬ä»¶è¾…åŠ©é€šè¿‡å¼•å…¥ä¸€ä¸ªæ–°çš„ Ring çº§åˆ«ï¼ˆç§°ä¸º **Root Mode**ï¼‰ï¼Œå…è®¸ Hypervisor ç›´æ¥è¿è¡Œåœ¨ Root Modeï¼Œè€Œ Guest OS è¿è¡Œåœ¨ Non-Root Modeã€‚
* **æ•ˆæœï¼š** æå¤§åœ°å‡å°‘äº† Ring åˆ‡æ¢çš„æ¬¡æ•°ï¼ŒæŸäº›ç‰¹æƒæŒ‡ä»¤ä¸å†éœ€è¦é™·å…¥é™·é˜±ï¼Œæ€§èƒ½æŸå¤±é™åˆ° 5% ä»¥ä¸‹ã€‚
* **å±€é™ï¼š** è¿™ç§ä¼˜åŒ–ä¸»è¦é’ˆå¯¹ CPU è®¡ç®—ï¼Œå¯¹äº I/O å¯†é›†å‹ä»»åŠ¡ï¼ŒæŸè€—ä¾ç„¶å·¨å¤§ã€‚

### 3.2 I/O è™šæ‹ŸåŒ–çš„æŒ‘æˆ˜ï¼ˆç½‘å¡ä¸ç¡¬ç›˜ï¼‰

è™šæ‹Ÿæœºè®¿é—®ç½‘å¡ï¼ˆNICï¼‰æˆ–ç¡¬ç›˜æ—¶ï¼Œæ˜¯æœ€å¤§çš„èƒ½è€—é™·é˜±ï¼š
1.  **å…¨è™šæ‹ŸåŒ–ï¼ˆFull Virtualizationï¼‰ï¼š** Hypervisor æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„ç½‘å¡è®¾å¤‡ã€‚æ¯æ¬¡ I/O éƒ½éœ€è¦å¤šæ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œèƒ½è€—æœ€é«˜ã€‚
2.  **åŠè™šæ‹ŸåŒ–ï¼ˆPara-virtualizationï¼‰ï¼š** Guest OS çŸ¥é“è‡ªå·±æ˜¯è™šæ‹Ÿæœºï¼Œä¸»åŠ¨ä½¿ç”¨æ›´é«˜æ•ˆçš„é©±åŠ¨ï¼ˆä¾‹å¦‚ VirtIOï¼‰ã€‚è™½ç„¶æ›´å¿«ï¼Œä½†ä»éœ€ Hypervisor å‚ä¸è°ƒåº¦ã€‚
3.  **SR-IOV (å•æ ¹ I/O è™šæ‹ŸåŒ–)ï¼š** **èƒ½æ•ˆæœ€ä¼˜è§£ã€‚** å…è®¸è™šæ‹Ÿæœºç›´æ¥ç‹¬å ä¸€å—ç‰©ç†ç½‘å¡çš„è™šæ‹ŸåŠŸèƒ½ã€‚å®Œå…¨ç»•è¿‡ Hypervisor è¿›è¡Œæ•°æ®ä¼ è¾“ï¼ŒI/O æ€§èƒ½æ¥è¿‘è£¸é‡‘å±ï¼Œèƒ½è€—ç¨æœ€ä½ã€‚ä½†å®ƒç‰ºç‰²äº†çµæ´»æ€§ï¼ˆèµ„æºè¢«ç‹¬å ï¼‰ã€‚



---

## 4. ğŸŒ è¡Œä¸šå±•æœ›ï¼šé™ä½èƒ½è€—ç¨çš„æœªæ¥æ¶æ„

éšç€ AI è®­ç»ƒå’Œæ¨ç†å¯¹ä½å»¶è¿Ÿã€é«˜ååçš„éœ€æ±‚çˆ†å‘ï¼Œé™ä½è™šæ‹ŸåŒ–èƒ½è€—ç¨å·²æˆä¸ºäº‘è®¡ç®—å‚å•†çš„é‡ç‚¹ã€‚

* **è£¸é‡‘å±å’Œå®¹å™¨åŒ–ï¼š** å¯¹äºå¯¹æ€§èƒ½è¦æ±‚æé«˜çš„ AI/ML ä»»åŠ¡ï¼Œè¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·é€‰æ‹© **è£¸é‡‘å±ï¼ˆBare Metalï¼‰** æˆ– **è½»é‡çº§å®¹å™¨ï¼ˆContainerï¼‰**ã€‚å®¹å™¨å…±äº« Host OS å†…æ ¸ï¼ŒHypervisor æŸè€—å‡ ä¹ä¸ºé›¶ã€‚è¿™æ˜¯æœªæ¥é«˜æ€§èƒ½è®¡ç®—çš„ä¸»æµã€‚
* **AI è°ƒåº¦å™¨ï¼š** äº‘å‚å•†æ­£åœ¨åˆ©ç”¨ AI ç®—æ³•ï¼Œé¢„æµ‹å„ä¸ªè™šæ‹Ÿæœºå¯¹èµ„æºçš„äº‰æŠ¢ç¨‹åº¦ï¼Œå°†ä½åŠŸè€—ã€ä½ I/O çš„ VM é›†ä¸­è°ƒåº¦åˆ°åŒä¸€æ‰¹ç‰©ç† CPU ä¸Šï¼Œå°†é«˜æ€§èƒ½ VM è°ƒåº¦åˆ°ç©ºé—²çš„ CPU ä¸Šï¼Œä»¥è¾¾åˆ°æ•´ä½“èƒ½æ•ˆæœ€ä¼˜ã€‚

## 5. ğŸ† æ€»ç»“ä¸äº’åŠ¨ï¼šä¸ºæ•ˆç‡ä¹°å•è¿˜æ˜¯ä¸ºéš”ç¦»ä¹°å•

### 5.1 æœ€ç»ˆç»“è®º (Final Thesis)

ä½ ä¸º 100% äº‘ CPU ä»˜è´¹ï¼Œä½†å®é™…å¯ç”¨æ€§èƒ½åªæœ‰ 70% ç”šè‡³æ›´ä½ï¼Œæ˜¯å› ä¸º Hypervisor å¿…é¡»èŠ±è´¹ç®—åŠ›æ¥æä¾›**å®‰å…¨éš”ç¦»ã€å¤šç§Ÿæˆ·ç®¡ç†å’Œèµ„æºå¼¹æ€§**ã€‚è¿™ç¬”**è™šæ‹ŸåŒ–èƒ½è€—ç¨**æ˜¯ä¸ºä½ äº«å—äº‘è®¡ç®—çš„ä¾¿åˆ©æ€§å’Œå®‰å…¨æ€§æ‰€æ”¯ä»˜çš„ç‰©ç†ä»£ä»·ã€‚

### 5.2 ã€ç¡…åŸºé—®ç­”ã€‘ 

åœ¨é€‰æ‹©äº‘è®¡ç®—æœåŠ¡æ—¶ï¼Œä½ ä¼šå¦‚ä½•æƒè¡¡ï¼Ÿ

> **è¯·åœ¨è¯„è®ºåŒºæŠ•ç¥¨ï¼š**
> * **A. å®‰å…¨è‡³ä¸Šå…šï¼š** æˆ‘æ„¿æ„ä¸º Hypervisor çš„éš”ç¦»ä»˜è´¹ï¼æ€§èƒ½æŸå¤± 30% æˆ‘ä¹Ÿèƒ½æ¥å—ï¼Œå®‰å…¨ç¬¬ä¸€ã€‚
> * **B. æ€§èƒ½æè‡´å…šï¼š** æˆ‘é€‰è£¸é‡‘å±æˆ– SR-IOVï¼æˆ‘éœ€è¦ 95% ä»¥ä¸Šçš„ç‰©ç†æ€§èƒ½ï¼Œå“ªæ€•éœ€è¦è‡ªå·±å¤„ç†éƒ¨åˆ†å®‰å…¨å’Œè¿ç»´å·¥ä½œã€‚



### ğŸ“š å‚è€ƒæ–‡çŒ® / References

1.  **[Intel/AMD Technical Guides]** *"Hardware-Assisted Virtualization (VT-x/AMD-V) Architecture and Overhead Analysis."* (æ³¨ï¼šå…³äº CPU è™šæ‹ŸåŒ–æŒ‡ä»¤é›†çš„æŠ€æœ¯è§„èŒƒ)
2.  **[USENIX ATC]** *"Quantifying the Performance Isolation and Resource Overhead of Hypervisors in Cloud Environments."* (æ³¨ï¼šå¯¹ Hypervisor æŸè€—è¿›è¡Œé‡åŒ–åˆ†æçš„ç»å…¸å­¦æœ¯è®ºæ–‡)
3.  **[Linux Foundation]** *"SR-IOV and DPDK: Low-Latency Networking in the Cloud."* (æ³¨ï¼šå…³äºé«˜æ€§èƒ½ I/O è™šæ‹ŸåŒ–æŠ€æœ¯çš„åº”ç”¨)