---
/**
 * 分享按钮组件
 * 支持分享到微信、微博等平台
 */

interface Props {
  title: string;
  url: string;
  description?: string;
}

const { title, url, description } = Astro.props;
const fullUrl = typeof window !== 'undefined' 
  ? window.location.href 
  : url.startsWith('http') 
    ? url 
    : `https://gjnx.cc${url}`;
---

<div class="share-buttons">
  <span class="share-label mono">分享:</span>
  <div class="share-items">
    <button 
      class="share-btn wechat"
      title="分享到微信"
      onclick="alert('请使用微信扫描二维码分享')"
    >
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
        <path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 0 0 .167-.054l1.903-1.114a.864.864 0 0 1 .717-.098 10.16 10.16 0 0 0 2.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 4.15-1.98 6.343-2.117-.576-3.16-4.226-5.655-8.588-5.655zM5.785 5.991c.642 0 1.162.529 1.162 1.18 0 .653-.52 1.182-1.162 1.182-.642 0-1.162-.529-1.162-1.182 0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18 0 .653-.52 1.182-1.162 1.182-.642 0-1.162-.529-1.162-1.182 0-.651.52-1.18 1.162-1.18zm5.34 3.539c-1.396 0-2.512 1.15-2.512 2.556 0 1.407 1.116 2.557 2.512 2.557 1.396 0 2.512-1.15 2.512-2.557 0-1.406-1.116-2.556-2.512-2.556zm-2.266 2.556c0 .653.52 1.182 1.162 1.182.642 0 1.162-.529 1.162-1.182 0-.651-.52-1.18-1.162-1.18-.642 0-1.162.529-1.162 1.18z"/>
      </svg>
    </button>
    <a 
      href={`https://service.weibo.com/share/share.php?url=${encodeURIComponent(fullUrl)}&title=${encodeURIComponent(title)}`}
      target="_blank"
      rel="noopener noreferrer"
      class="share-btn weibo"
      title="分享到微博"
    >
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
        <path d="M10.954 17.418c-4.297 0-7.785-3.489-7.785-7.785 0-4.297 3.488-7.785 7.785-7.785 4.297 0 7.785 3.488 7.785 7.785 0 4.296-3.488 7.785-7.785 7.785zm0-13.916c-3.384 0-6.131 2.747-6.131 6.131s2.747 6.131 6.131 6.131 6.131-2.747 6.131-6.131-2.747-6.131-6.131-6.131zm-1.313 9.785l-1.313-1.313 1.313-1.313 1.313 1.313-1.313 1.313zm2.626 0l-1.313-1.313 1.313-1.313 1.313 1.313-1.313 1.313zm2.626 0l-1.313-1.313 1.313-1.313 1.313 1.313-1.313 1.313z"/>
      </svg>
    </a>
    <button 
      class="share-btn copy"
      title="复制链接"
      data-url={fullUrl}
    >
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </button>
  </div>
</div>

<style>
  .share-buttons {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-4);
    background: rgba(10, 10, 10, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 4px;
  }

  .share-label {
    font-size: 0.85rem;
    color: var(--c-text-secondary);
  }

  .share-items {
    display: flex;
    gap: var(--space-3);
  }

  .share-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    color: var(--c-text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    padding: 0;
  }

  .share-btn:hover {
    border-color: var(--c-accent-cyan);
    color: var(--c-accent-cyan);
    background: rgba(0, 240, 255, 0.1);
    transform: translateY(-2px);
  }

  .share-btn.wechat:hover {
    border-color: #07c160;
    color: #07c160;
    background: rgba(7, 193, 96, 0.1);
  }

  .share-btn.weibo:hover {
    border-color: #e6162d;
    color: #e6162d;
    background: rgba(230, 22, 45, 0.1);
  }
</style>

<script>
  function initShareButtons() {
    const copyBtn = document.querySelector('.share-btn.copy');
    if (copyBtn) {
      copyBtn.addEventListener('click', () => {
        const url = copyBtn.getAttribute('data-url') || window.location.href;
        navigator.clipboard.writeText(url).then(() => {
          alert('链接已复制到剪贴板');
        }).catch(() => {
          // Fallback for older browsers
          const textarea = document.createElement('textarea');
          textarea.value = url;
          document.body.appendChild(textarea);
          textarea.select();
          try {
            document.execCommand('copy');
            alert('链接已复制到剪贴板');
          } catch {
            alert('复制失败，请手动复制');
          }
          document.body.removeChild(textarea);
        });
      });
    }
  }

  document.addEventListener('astro:page-load', initShareButtons);
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initShareButtons);
  } else {
    initShareButtons();
  }
</script>

