<div class="calculator glass-panel">
  <div class="calc-header mono">
    <span class="status-dot"></span>
    <h3>AI_CHIP_TCO_ANALYZER_V1</h3>
  </div>

  <div class="calc-body">
    <!-- Input Section -->
    <div class="input-grid">
      <div class="field">
        <label class="mono">CHIP_PRICE (CNY)</label>
        <input type="number" id="chip-price" value="250000" step="1000" />
      </div>
      <div class="field">
        <label class="mono">POWER_TDP (WATTS)</label>
        <input type="number" id="tdp" value="700" step="10" />
      </div>
      <div class="field">
        <label class="mono">PUE (OVERHEAD)</label>
        <input type="number" id="pue" value="1.3" step="0.01" />
      </div>
      <div class="field">
        <label class="mono">ELEC_RATE (CNY/kWh)</label>
        <input type="number" id="elec-rate" value="0.8" step="0.1" />
      </div>
      <div class="field">
        <label class="mono">DUTY_CYCLE (%)</label>
        <input type="range" id="duty-cycle" min="0" max="100" value="80" />
        <span id="duty-val" class="mono">80%</span>
      </div>
      <div class="field">
        <label class="mono">OPERATION_YEARS</label>
        <select id="years">
          <option value="1">1 YEAR</option>
          <option value="3" selected>3 YEARS</option>
          <option value="5">5 YEARS</option>
        </select>
      </div>
    </div>

    <!-- Output Section -->
    <div class="result-box mono">
      <div class="result-item">
        <span>> EST_OPEX (ENERGY)</span>
        <span id="opex-val" class="value highlight">0</span>
      </div>
      <div class="result-item total">
        <span>> TOTAL_OWNERSHIP_COST</span>
        <span id="total-val" class="value large">0</span>
      </div>
      <div class="progress-bar-container">
        <div id="cost-ratio" class="progress-fill"></div>
      </div>
      <p class="note">ENERGY_COST_RATIO: <span id="ratio-text">0%</span></p>
    </div>
  </div>
</div>

<style>
  .calculator {
    background: rgba(10, 10, 10, 0.8);
    border: 1px solid #333;
    padding: 2rem;
    max-width: 800px;
    margin: 2rem auto;
    position: relative;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
  }

  .calc-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 2rem;
    border-bottom: 1px solid #222;
    padding-bottom: 1rem;
    color: var(--c-accent-cyan);
  }

  .status-dot {
    width: 8px;
    height: 8px;
    background: var(--c-accent-cyan);
    border-radius: 50%;
    box-shadow: 0 0 10px var(--c-accent-cyan);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% { opacity: 0.4; }
    50% { opacity: 1; }
    100% { opacity: 0.4; }
  }

  .input-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .field {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .field label {
    font-size: 0.75rem;
    color: #888;
  }

  input, select {
    background: #050505;
    border: 1px solid #222;
    color: #fff;
    padding: 10px;
    font-family: var(--font-mono);
    border-radius: 4px;
    outline: none;
  }

  input:focus {
    border-color: var(--c-accent-cyan);
    box-shadow: 0 0 10px rgba(0, 240, 255, 0.2);
  }

  input[type="range"] {
    accent-color: var(--c-accent-cyan);
    background: transparent;
    border: none;
    padding: 0;
  }

  .result-box {
    background: #080808;
    border: 1px solid #222;
    padding: 1.5rem;
    border-left: 4px solid var(--c-accent-cyan);
  }

  .result-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1rem;
    font-size: 0.9rem;
  }

  .result-item.total {
    border-top: 1px dashed #333;
    padding-top: 1rem;
    margin-top: 1rem;
  }

  .value.highlight { color: var(--c-accent-amber); }
  .value.large { font-size: 1.5rem; color: var(--c-accent-cyan); font-weight: bold; }

  .progress-bar-container {
    width: 100%;
    height: 6px;
    background: #111;
    border-radius: 3px;
    margin: 1.5rem 0 0.5rem;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: var(--c-accent-amber);
    width: 0%;
    transition: width 0.3s ease;
  }

  .note { font-size: 0.7rem; color: #555; }

  @media (max-width: 600px) {
    .calculator { padding: 1rem; }
  }
</style>

<script>
  function calculate() {
    const price = parseFloat((document.getElementById('chip-price') as HTMLInputElement).value) || 0;
    const tdp = parseFloat((document.getElementById('tdp') as HTMLInputElement).value) || 0;
    const pue = parseFloat((document.getElementById('pue') as HTMLInputElement).value) || 1;
    const rate = parseFloat((document.getElementById('elec-rate') as HTMLInputElement).value) || 0;
    const duty = parseFloat((document.getElementById('duty-cycle') as HTMLInputElement).value) || 0;
    const years = parseFloat((document.getElementById('years') as HTMLSelectElement).value) || 1;

    // Calculation
    // Total Hours = Years * 365 * 24
    // Active Hours = Total Hours * (Duty / 100)
    // Energy (kWh) = TDP * PUE * Active Hours / 1000
    // OpEx = Energy * Rate
    
    const totalHours = years * 365 * 24;
    const energyKwh = (tdp * pue * totalHours * (duty / 100)) / 1000;
    const opex = energyKwh * rate;
    const total = price + opex;
    
    const energyRatio = (opex / total) * 100;

    // Update UI
    const opexEl = document.getElementById('opex-val');
    const totalEl = document.getElementById('total-val');
    const ratioEl = document.getElementById('cost-ratio');
    const ratioText = document.getElementById('ratio-text');
    const dutyVal = document.getElementById('duty-val');

    if (opexEl) opexEl.innerText = `¥ ${opex.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
    if (totalEl) totalEl.innerText = `¥ ${total.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
    if (ratioEl) ratioEl.style.width = `${energyRatio}%`;
    if (ratioText) ratioText.innerText = `${energyRatio.toFixed(1)}%`;
    if (dutyVal) dutyVal.innerText = `${duty}%`;
  }

  // Initial calculation
  calculate();

  // Add listeners
  const inputs = ['chip-price', 'tdp', 'pue', 'elec-rate', 'duty-cycle', 'years'];
  inputs.forEach(id => {
    document.getElementById(id)?.addEventListener('input', calculate);
  });
</script>
